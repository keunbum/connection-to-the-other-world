# Index
   * ## [네트워크 프로그래밍과 소켓의 이해](#네트워크-프로그래밍과-소켓의-이해)
      * ### [네트워크 프로그래밍과 소켓에 대한 매우 간단한 이해](#네트워크-프로그래밍과-소켓에-대한-매우-간단한-이해)
      * ### [전화 받는 소켓의 구현](#전화-받는-소켓의-구현)
      * ### [전화 거는 소켓의 구현](#전화-거는-소켓의-구현)

   * ## [How to Execute](#how-to-execute)
      * ### [Compile](#compile)
      * ### [Execute](#execute)

# 네트워크 프로그래밍과 소켓의 이해

## 네트워크 프로그래밍과 소켓에 대한 매우 간단한 이해

... 운영체제에서 '소켓(Socket)'이라는 것을 제공하기 때문이다.
이는 물리적으로 연결된 네트워크 상에서의 데이터 송수신에 사용할 수 있는 소프트웨어적인
장치를 의미한다. 때문에 데이터 송수신의 원리를 이론적으로 잘 몰라도, 소켓이라는 것을 이용해서 데이터를
주고 받을 수 있다.

멀리 떨어져 있는 컴퓨터와 데이터를 송수신하려면 인터넷이라는 네트워크 망에 연결해야 한다.
그리고 프로그래밍에서의 '소켓'은 네트워크 망의 연결에 사용되는 도구이다. 이렇듯 연결이라는 의미가 담겨있어서
'소켓'이라는 표현을 사용한다. 그리고 그 의미를 조금 더 확장해서, 소켓은 네트워크를 통한 두 컴퓨터의 연결을
의미하기도 한다.

## 전화 받는 소켓의 구현

소켓도 크게 두 가지로 나뉘는데, 그 중 우리가 처음 이야기할 TCP 소켓이라는 것은 전화기에 비유할 수 있다.

전화기는 거는 것과 받는 것이 동시에 가능하지만, 소켓은 거는 용도의 소켓을
완성하는 방식과 받는 용도의 소켓을 완성하는 방식에 차이가 있다.

---

집에 전화를 놓으려면 먼저 전화기를 하나 구입해야 한다.
다음은 전화기에 해당하는 소켓을 생성하는 함수이다.

```c
#include <sys/socket.h>
int socket(int domain, int type, int protocol);
// -> 성공 시 파일 디스크립터, 실패 시 -1 반환
```

참고로 전화기는 구입만 해 놓으면 전화국에서 직원이 와서 가설도 해주고, 전화번호도 할당해 주지만,
소켓은 우리가 직접 가설을 해야 한다. 이점이 소켓 프로그래밍을 어렵게 하는 이유가 된다. 하지만
몇 번 가설해 보면, 어렵지 않음을 알게 될 것이다.

---

그런데 전화기만 장만해 놓았다고 해서 끝난 것은 아니다. 전화기를 장만했으니, 전화번호를 부여 받아야 한다.
그래야 누군가 나에게 전화를 걸 수 있지 않겠는가?

소켓도 마찬가지이다. 전화기에 전화번호가 할당되는 것처럼(실제로 전화기에 전화번호가 부여되는 것은 아니지만),
다음 함수를 이용해서 앞서 생성한 소켓에 IP와 포트번호라는, 소켓의 주소정보에 해당하는 것을 할당해야 한다.

```c
#include <sys/socket.h>
int bind(int sockfd, struct sockaddr *myaddr, socklen_t addrlen);
// -> 성공 시 0, 실패 시 -1 반환
```

bind 함수 호출을 통해서 소켓에 주소 정보까지 할당했으니, 이제 전화를 받기 위한 모든 준비가 끝난 셈이다.
따라서 전화기를 전화 케이블에 연결시켜서 전화가 걸려오기만을 기다리면 된다.

---

전화기의 전화 케이블에 연결되는 순간 전화를 받을 수 있는 상태가 된다. 이는 누군가 전화를 걸어서 연결 요청을
할 수 있는 상태에 놓임을 뜻한다. 마찬가지로 소켓도 연결 요청이 가능한 상태가 되어야 한다.

```c
#include <sys/socket.h>
int listen(int sockfd, int backlog);
// -> 성공 시 0, 실패 시 -1 반환
```

이제 전화기가 전화 케이블에 연결되었으니, 전화벨이 울릴 것이고, 전화벨이 울리면 통화를 위해서
수화기를 들어야 한다.

---

수화기를 들었다는 것은 연결 요청에 대한 수락을 의미한다. 그리고 이는 소켓도 마찬가지이다. 누군가
데이터의 송수신을 위해 연결 요청을 해오면, 다음 함수 호출을 통해서 그 요청을 수락해야 한다.

```c
#include <sys/socket.h>
int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);
// -> 성공 시 파일 디스크립터, 실패 시 -1 반환
```

정리해보면

    * 1단계. 소켓 생성                  socket 함수호출
    * 2단계. IP주소와 PORT번호 할당     bind 함수호출
    * 3단계. 연결요청 가능상태로 변경   listen 함수호출
    * 4단계. 연결요청에 대한 수락       accept 함수호출

---

## 전화 거는 소켓의 구현

앞에서는 전화를 거는(연결을 요청하는) 기능의 함수를 소개하지 않았다. 이는 클라이언트 소켓을
대상으로 호출하는 함수이기 때문이다. 다음은 전화를 거는 기능의 함수이다.

```c
#include <sys/socket.h>
int connect(int sockfd, struct sockaddr *serv_addr, socklen_t addrlen);
// -> 성공 시 0, 실패 시 -1
```

클라이언트 프로그램에서는 socket 함수호출을 통한 소켓의 생성과 connect 함수 호출을 통한
서버로의 연결 요청 과정만이 존재한다.


---

# How To Execute

## Compile

### Server Side
```
$ gcc hello_server.c -o hserver
```

### Client Side
```
$ gcc hello_client.c -o hclient
```

## Execute
You should run the server side first.

### Server Side
```bash
$ ./hserver 9190
# Of course, other ports can be used.
```

### Client Side
```bash
$ ./hclient 127.0.0.1 9190
# A different ip address can be used.
```
