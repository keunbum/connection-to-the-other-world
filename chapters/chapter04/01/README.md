# 04-1 TCP와 UDP에 대한 이해

인터넷 프로토콜 기반 소켓의 경우, 데이터를 전송하는 방법에 따라 **TCP** 소켓과 **UDP** 소켓으로 나뉘고,
특히 TCP 소켓의 경우 연결을 지향하기 때문에 '**스트림 기반 소켓**'이라고도 이야기한다.  
TCP는 Transmission Control Protocol의 약자로써 '데이터 전송과정의 컨트롤'이라는 뜻을 담고 있다. 때문에
TCP 소켓의 정확한 이해를 위해서는 컨트롤의 방법과 범위에 대해 살펴보는 것이 도움이 된다.

<추가적으로 읽어 볼 만한 자료>
* [Naver D2 HelloWorld](https://d2.naver.com/helloworld/47667)


---

## TCP/IP 프로토콜 스택

TCP를 이야기하기에 앞서 TCP가 속해있는 'TCP/IP 프로토콜 스택'을 먼저 설명하고자 한다. 다음 그림들은 TCP/IP 프로토콜 스택(Stack, 계층)을 보여준다.

![데이터 전송 시 TCP/IP 네트워크 스택의 각 레이어 별 동작 과정](https://d2.naver.com/content/images/2015/06/helloworld-47667-1.png)

![Difference between OSI and TCP/IP model](https://www.guru99.com/images/1/093019_0615_TCPIPModelW3.png)

![wikimedia_tcp/ip](https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/UDP_encapsulation.svg/525px-UDP_encapsulation.svg.png)


위 그림(그림에서는 UDP가 그려져 있지만 TCP도 계층 구조는 같음)을 통해 TCP/IP 스택이 총 네 개의 계층으로 나뉨을 알 수 있는데, 이는 데이터 송수신의 과정을 네 개의 영역으로 계층화했다는 의미로 볼 수 있다. 즉 '인터넷 기반의 효율적인 데이터 전송'이라는 커다란 하나의 문제를 하나의 프로토콜 설계로 해결한 것이 아니라, 그 문제를 작게 나눠서 계층화하려는 노력이 시도되었고, 그 결과가 'TCP/IP 프로토콜 스택'인 것이다.  
각각의 계층을 담당하는 것은 운영체제와 같은 소프트웨어이기도 하고, NIC와 같은 물리적인 장치이기도 하다.  

>🔖 **OSI 7 Layer**  
> 데이터 통신에 사용되는 프로토콜 스택은 7계층으로 세분화된다. 그러나 앞서 보인 그림에서와 같이 4계층으로 구분 짓기도 한다. 만약에 프로토콜 스택 7계층을 세부적으로 이해하기 원한다면 데이터 통신에 관련된 서적을 참고하면 된다. 하지만 프로그래머의 관점에서는 4계층으로 이해하고 있어도 충분하다. 

---

## TCP/IP 프로토콜의 탄생 배경

우리는 지금까지 소켓의 생성 및 활용에만 관심을 둬서 생각하지 못했지만, 네트워크는 소프트웨어만 가지고 해결할 수 있는 문제가 아니다. 소프트웨어가 존재하기 전에 하드웨어적으로 시스템이 구축되어 있어야 하고, 그러한 물리적 환경을 기반으로 각종 소프트웨어적인 알고리즘을 필요로 한다.  
문제를 영역별로 나눠서 해결하다 보니 프로토콜이 여러 개 만들어졌으며, 이들은 계층구조를 통해서 상호간에 관계를 맺게 되었다. 

>🔖 **개방형 시스템(Open System)**  
>구체적으로 프로토콜을 계층화해서 얻게 되는 장점에는 어떤 것들이 있을까? 프로토콜 설계의
용이성? 물론 이것도 장점이라 말하기엔 충분하다. 그러나 이보다 더 중요하 이유가 있으니, 이는
바로 표준화 작업을 통한 '개방형 시스템(Open System)'의 설계이다.  
>
>표준이라는 것은 감추는 것이 아니라 활짝 열고 널리 알려서 많은 사람이 따르도록 유도하는 것
이다. 따라서 여러 개의 표준을 근거로 설계된 시스템을 가리켜 '개방형 시스템'이라 하며, 우리
가 지금 공부하고 있는 TCP/IP 프로토콜 스택 역시 개방형 시스템의 하나이다.
>
>IP 계층을 담당하는 라우터라는 장비가 있다. 회사에서 A사의 라우터 장비를 사용하고 있었는데,
이를 B사의 라우터 장비로 교체하려고 한다. 이때 어렵지 않게 교체가 가능하다. 반드시 같은 회사의
같은 모델로 교체해야 하는 것은 아니다. 모든 라우터 제조사들이 IP 계층의 표준에 맞춰서
라우터를 제작하기 때문이다. 컴퓨터에 있는 네트워크 카드, 소위 말하는 랜카드 또한 랜카드 제조사가 LINK 계층의 표준을 따르고 있다.  
>
>이렇듯 표준이 존재한다는 것은 그만큼 빠른 속도의 기술발전이 가능하다는 것을 의미한다. 그리고 이것이 시스템을 개방형으로 설계하는 가장 큰 이유이기도 하다. 사실 소프트웨어 공학에서의 '객체지향(Object Oriented)'의 탄생배경에도 소프트웨어의 발전을 위해서는 표준이 필요하다는 생각이 큰 몫을 차지했다. 그만큼 표준이라는 것은
기술 발전에 있어서 중요한 요소이다.

---

## LINK 계층

LINK 계층은 물리적인 영역의 표준화에 대한 결과이다. 이는 가장 기본이 되는 영역으로
LAN, WAN, MAN과 같은 네트워크 표준과 관련된 프로토콜을 정의하는 영역이다.

---

## IP 계층

물리적인 연결이 형성되었으니, 데이터를 보낼 기본준비가 되었다. 그런데 복잡하게 연결되어 있는 인터넷을 통한
데이터의 전송을 위해 선행되어야 할 일은 경로의 선택이다. 목적지로 데이터를 전송하기 위해서 중간에 어떤 경로를
거쳐갈 것인가? 이 문제를 해결하는 것이 IP계층이고, 이 계층에서 사용하는 프로토콜이 IP(Internet Protocol)이다.  
IP 자체는 비 연결지향적이며 신뢰할 수 없는 프로토콜이다. 데이터를 전송할 때마다 거쳐야 할 경로를
선택해 주지만, 그 경로는 일정치 않다. 특히 데이터 전송 도중에 경로상에 문제가 발생하면 다른 경로를 선택해 주는데, 이 과정에서 데이터가 손실되거나 오류가 발생하는 등의 문제가 발생한다고 해서 이를 해결해주지 않는다.
즉, 오류발생에 대한 대비가 되어 있지 않은 프로토콜이 IP이다.

---

## TCP/UDP 계층

데이터의 전송을 위한 경로의 탐색을 IP 계층에서 해결해주니, 그 경로를 기준으로 데이터를 전송만하면
된다. TCP와 UDP 계층은 이렇듯 IP 계층에서 알려준 경로 정보를 바탕으로 데이터의 실제 송수신을 담당한다.
때문에 이 계층을 가리켜 '전송(Transport) 계층'이라 한다.  
TCP는 신뢰성 있는 데이터의 전송을 담당한다. 그런데 TCP가 데이터를 보낼 때 기반이 되는 프로토콜이 IP이다(이것이
프로토콜이 스택의 구조로 계층화되어 있는 이유이다).  
IP는 오로지 하나의 데이터 패킷(데이터 전송의 기본 단위)이 전송되는 과정에만 중심을 두고 설계되었다.
따라서 여러 개의 데이터 패킷을 전송한다 하더라도 각각의 패킷이 전송되는 과정은 IP에 의해서 진행되므로 전송의 순서는
물론이거니와 전송 그 자체를 신뢰할 수 없다. 만약에 IP만을 이용해서 데이터를 전송한다면 먼저 전송한 A 패킷보다 뒤에
전송한 B 패킷이 먼저 도달할 수도 있다. 그리고 이어서 전송한 A, B, C 패킷 중에서 A와 C 패킷만 전송될 수 있으며,
그나마 C 패킷은 손상된 상태로 전송될 수도 있다. 반면에 TCP 프로토콜이 추가되어 데이터를 송수신하면 다음과 같은 대화를 주고 받게 된다.

* 호스트 A: 두 번째 패킷까지 잘 받았어.
* 호스트 B: OK.  

* 호스트 A: 세 번째 패킷까지 잘 받았어.
* 호스트 B: 네 번째 패킷까지 보냈는데? 네 번째 패킷은 못받았나 보네. 다시 보낼게.

이것이 바로 TCP의 역할이다. 이렇듯 데이터를 주고받는 과정에서 서로 데이터의 주고 받음을 확인한다면,
그리고 분실된 데이터에 대해서 재전송해준다면, 데이터의 전송을 신뢰할 수 있지 않겠는가? 비록 IP가 데이터의
전송을 보장하지 않더라도 말이다.

![Transmission Control Protocol](https://www.tutorialsweb.com/networking/tcp-ip/images/fig9_TCPtrans.jpg)

정리하자면 IP의 상위계층에서 호스트 대 호스트의 데이터 송수신 방식을 약속하는 것이 TCP와 UDP이며, TCP는 확인절차를
걸쳐서 신뢰성 없는 IP에 신뢰성을 부여한 프로토콜이라 할 수 있다.

---

## APPLICATION 계층

지금까지 기술한 내용은 소켓을 생성하면 데이터 송수신과정에서 자동으로 처리되는 것들이다. 데이터의
전송경로를 확인하는 과정이나 데이터 수신에 대한 응답 과정이 소켓이라는 것 하나에 감춰져 있기 때문이다.
그러나 감춰져 있다는 표현보다는 이러한 일들에 대해서 프로그래머를 자유롭게 해줬다는 표현이 더 정확하다.
즉, 프로그래밍에 있어서 이러한 과정을 신경 쓰지 않아도 된다는 말이다. 하지만 신경 쓰지 않아도 될 뿐이지,
몰라도 된다는 뜻은 아니다. 이러한 이론적인 내용들도 알고 있어야 필요에 맞는 네트워크 프로그램을 작성할 수 있다.  
최종적으로 소켓이라는 도구가 우리에게 주어졌고, 우리는 이 도구를 이용해서 무엇인가를 만들면 된다. 이렇게
무엇인가를 만드는 과정에서 프로그램의 성격에 따라 클라이언트와 서버간의 데이터 송수신에 대한 약속(규칙)들이
정해지기 마련인데, 이를 가리켜 APPLICATION 프로토콜이라 한다. 그리고 대부분의 네트워크 프로그래밍은 APPLICATION
프로토콜의 설계 및 구현이 상당부분을 차지한다.

